Проект: Сервис коротких ссылок


## How to Run
```bash
docker-compose up --build
```

## Архитектурное описание

![img.png](img.png)

### Разделение на микросервисы

```plain
Разделение функциональности на микросервисы позволяет достичь масштабируемости, гибкости и устойчивости к отказам. В рамках данного проекта функциональность разделена на следующие микросервисы:

1. UrlShorteningService: отвечает за генерацию коротких ссылок и их хранение.
2. AnalyticsService: собирает статистику по доступам к ссылкам.
3. AuthService: отвечает за аутентификацию и авторизацию пользователей.
4. ApiGateway: предоставляет единый входной точек для всех клиентов, делегируя запросы соответствующим микросервисам.

Причины выделения функциональности:
1. UrlShorteningService и AnalyticsService имеют разные требования к масштабируемости и производительности.
2. AuthService может быть использован другими сервисами в будущем.
3. ApiGateway упрощает управление и координацию взаимодействия между клиентами и микросервисами.
```
### Выбор способа коммуникации
```plain
gRPC: используется для межсервисного взаимодействия, так как он обеспечивает высокую производительность и эффективную сериализацию данных. Это особенно важно для сервисов, которые должны обрабатывать большое количество запросов с минимальной задержкой.
Kafka: используется для асинхронной передачи сообщений между микросервисами, что позволяет обрабатывать большие объемы данных в режиме реального времени и улучшает отказоустойчивость системы.

Логика выбора:
gRPC подходит для запросов, требующих немедленного ответа, например, создание короткой ссылки.
Kafka подходит для передачи событий, которые могут обрабатываться асинхронно, например, сбор статистики доступа к ссылкам.
```
### Выбор базы данных
```plain
ClickHouse: выбрана для хранения аналитических данных из-за ее высокой производительности при выполнении сложных запросов и обработке больших объемов данных.
MongoDB: выбрана для хранения данных пользователей и коротких ссылок благодаря ее гибкости и возможности горизонтального масштабирования.

Причины выбора:
ClickHouse предоставляет эффективные инструменты для аналитики, такие как агрегатные функции и материализованные представления.
MongoDB обеспечивает гибкость в работе с неструктурированными данными и легко масштабируется.
```


### REST API Документация
1. Создание короткой ссылки

Endpoint: POST /createUrl

Описание: Этот эндпоинт используется для создания короткой ссылки на указанный оригинальный URL.

Request Body:

```json
{
"original_url": "https://example.com"
}
```
Response Body:

```json
{
"short_url": "http://short.url/abc123"
}
```
HTTP Codes:
```
201 Created: Успешно создана короткая ссылка. 
400 Bad Request: Неверный запрос (например, отсутствует обязательное поле).
500 Internal Server Error: Ошибка на стороне сервера.
```

2. Получение оригинального URL по короткой ссылке

Endpoint: GET /getUrl

Описание: Этот эндпоинт используется для получения оригинального URL по короткой ссылке.

Request Parameters:
```json
"short_url": "gwgsd".
```
Response Body:
```json
{
"original_url": "https://example.com"
}
```
HTTP Codes:
```
302 Found: Успешный редирект на оригинальный URL.
404 Not Found: Короткая ссылка не найдена.
500 Internal Server Error: Ошибка на стороне сервера.
```

3.Получение статистики по URL

Endpoint: GET /getUrlStats

Описание: Этот эндпоинт используется для получения статистики по количеству обращений к указанному URL.

Request Parameters:
```json
{
  "short_url": "fwfwf"
}
```
Response Body:

```json
{
"short_url": "http://short.url/abc123",
"access_count": 42
}
```
HTTP Codes:
```
200 OK: Успешное получение статистики.
404 Not Found: Короткая ссылка не найдена.
500 Internal Server Error: Ошибка на стороне сервера.
```

4. Регистрация пользователя

Endpoint: POST /register

Описание: Этот эндпоинт используется для регистрации нового пользователя.

Request Body:

```json
{
"email": "user@example.com",
"password": "securepassword"
}
```
Response Body:

```json
{
"user_id": 12345
}
```
HTTP Codes:
```
201 Created: Пользователь успешно зарегистрирован.
400 Bad Request: Неверный запрос (например, отсутствует обязательное поле).
409 Conflict: Пользователь с таким email уже существует.
500 Internal Server Error: Ошибка на стороне сервера.
```

5. Логин пользователя

Endpoint: POST /login

Описание: Этот эндпоинт используется для аутентификации пользователя.

Request Body:

```json
{
"email": "user@example.com",
"password": "securepassword"
}
```
Response Body:

```json
{
"token": "jwt-token"
}
```
HTTP Codes:
```
200 OK: Пользователь успешно аутентифицирован.
400 Bad Request: Неверный запрос (например, отсутствует обязательное поле).
401 Unauthorized: Неверный email или пароль.
500 Internal Server Error: Ошибка на стороне сервера.
``` 